mosys_lib_cros_config_src = [
  'cros_config.c',
  'cros_config_struct.c',
  'cros_config_data.c',
]

src = []
deps = []
link_with = []

# Cros config is a special snowflake.
if use_cros_config
  src += mosys_lib_cros_config_src
  fdt_dep = meson.get_compiler('c').find_library('fdt')
  deps += fdt_dep
  dtb_lib = static_library(
    'cros_config_dtb',
    ['config.dtb.S'],
    c_args: [
      '-Itools/vpd_encode',
      '-D__ASSEMBLY__',
      '-c',
    ],
    link_args: [
      '-znoexecstack',
      '-r',
    ],
  )
  link_with += dtb_lib
endif

libmosys_lib_cros_config = static_library(
  'mosys_lib_cros_config',
  [src],
  dependencies: deps,
  include_directories : include_common,
  link_with: link_with,
  pic: true,
)
